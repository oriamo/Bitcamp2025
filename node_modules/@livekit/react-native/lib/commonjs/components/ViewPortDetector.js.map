{"version":3,"names":["Object","defineProperty","exports","value","default","_react","_interopRequireWildcard","require","_reactNative","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","has","get","n","__proto__","a","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_extends","assign","bind","arguments","length","apply","_defineProperty","_toPropertyKey","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","DEFAULT_DELAY","TimeoutHandler","constructor","id","handler","handlerRef","clear","clearTimeout","setIntervalWithTimeout","callback","intervalMs","handleWrapper","cleared","timeout","setTimeout","ViewPortDetector","Component","props","disabled","delay","disabledValue","delayValue","AppState","currentState","nextAppState","nextAppStateActive","lastAppStateActive","checkVisibility","hasValidTimeout","stopWatching","startWatching","interval","_this$interval","view","updateVisibility","measure","_x","_y","width","height","_pageX","_pageY","checkInViewPort","isVisible","lastValue","_this$props$onChange","_this$props","onChange","state","rectTop","rectBottom","componentDidMount","appStateSubscription","addEventListener","handleAppStateChange","componentWillUnmount","_this$appStateSubscri","remove","UNSAFE_componentWillReceiveProps","nextProps","propKey","render","createElement","View","collapsable","ref","component","children"],"sources":["ViewPortDetector.tsx"],"sourcesContent":["'use strict';\n\nimport React, { Component, type PropsWithChildren } from 'react';\nimport {\n  AppState,\n  type AppStateStatus,\n  type NativeEventSubscription,\n  View,\n  type ViewStyle,\n} from 'react-native';\n\nconst DEFAULT_DELAY = 1000;\n\nexport type Props = {\n  disabled?: boolean;\n  style?: ViewStyle;\n  onChange?: (isVisible: boolean) => void;\n  delay?: number;\n  propKey?: any;\n};\n\nclass TimeoutHandler {\n  private handlerRef: { id: any } = { id: -1 };\n\n  get handler(): any {\n    return this.handlerRef.id;\n  }\n  set handler(n: any) {\n    this.handlerRef.id = n;\n  }\n\n  clear() {\n    clearTimeout(this.handlerRef.id as any);\n  }\n}\n\nfunction setIntervalWithTimeout(\n  callback: (clear: () => void) => any,\n  intervalMs: number,\n  handleWrapper = new TimeoutHandler()\n): TimeoutHandler {\n  let cleared = false;\n\n  const timeout = () => {\n    handleWrapper.handler = setTimeout(() => {\n      callback(() => {\n        cleared = true;\n        handleWrapper.clear();\n      });\n      if (!cleared) {\n        timeout();\n      }\n    }, intervalMs);\n  };\n  timeout();\n  return handleWrapper;\n}\n\n/**\n * Detects when this is in the viewport and visible.\n *\n * Will not fire visibility changes for zero width/height components.\n */\nexport default class ViewPortDetector extends Component<\n  PropsWithChildren<Props>\n> {\n  private lastValue: boolean | null = null;\n  private interval: TimeoutHandler | null = null;\n  private view: View | null = null;\n  private lastAppStateActive = false;\n  private appStateSubscription: NativeEventSubscription | null = null;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = { rectTop: 0, rectBottom: 0 };\n  }\n\n  componentDidMount() {\n    this.lastAppStateActive = AppState.currentState === 'active';\n    this.appStateSubscription = AppState.addEventListener(\n      'change',\n      this.handleAppStateChange\n    );\n    if (this.hasValidTimeout(this.props.disabled, this.props.delay)) {\n      this.startWatching();\n    }\n  }\n\n  componentWillUnmount() {\n    this.appStateSubscription?.remove();\n    this.appStateSubscription = null;\n    this.stopWatching();\n  }\n\n  hasValidTimeout = (disabled?: boolean, delay?: number): boolean => {\n    let disabledValue = disabled ?? false;\n    let delayValue = delay ?? DEFAULT_DELAY;\n    return (\n      AppState.currentState === 'active' && !disabledValue && delayValue > 0\n    );\n  };\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (!this.hasValidTimeout(nextProps.disabled, nextProps.delay)) {\n      this.stopWatching();\n    } else {\n      if (this.props.propKey !== nextProps.propKey) {\n        this.lastValue = null;\n      }\n      this.startWatching();\n    }\n  }\n  handleAppStateChange = (nextAppState: AppStateStatus) => {\n    let nextAppStateActive = nextAppState === 'active';\n    if (this.lastAppStateActive !== nextAppStateActive) {\n      this.checkVisibility();\n    }\n    this.lastAppStateActive = nextAppStateActive;\n\n    if (!this.hasValidTimeout(this.props.disabled, this.props.delay)) {\n      this.stopWatching();\n    } else {\n      this.startWatching();\n    }\n  };\n\n  startWatching = () => {\n    if (this.interval) {\n      return;\n    }\n    this.interval = setIntervalWithTimeout(\n      this.checkVisibility,\n      this.props.delay || DEFAULT_DELAY\n    );\n  };\n\n  stopWatching = () => {\n    this.interval?.clear();\n    this.interval = null;\n  };\n\n  checkVisibility = () => {\n    if (!this.view) {\n      return;\n    }\n\n    if (AppState.currentState !== 'active') {\n      this.updateVisibility(false);\n      return;\n    }\n\n    this.view.measure((_x, _y, width, height, _pageX, _pageY) => {\n      this.checkInViewPort(width, height);\n    });\n  };\n  checkInViewPort = (width?: number, height?: number) => {\n    let isVisible: boolean;\n    // Not visible if any of these are missing.\n    if (!width || !height) {\n      isVisible = false;\n    } else {\n      isVisible = true;\n    }\n    this.updateVisibility(isVisible);\n  };\n\n  updateVisibility = (isVisible: boolean) => {\n    if (this.lastValue !== isVisible) {\n      this.lastValue = isVisible;\n      this.props.onChange?.(isVisible);\n    }\n  };\n  render() {\n    return (\n      <View\n        collapsable={false}\n        ref={(component) => {\n          this.view = component;\n        }}\n        {...this.props}\n      >\n        {this.props.children}\n      </View>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}