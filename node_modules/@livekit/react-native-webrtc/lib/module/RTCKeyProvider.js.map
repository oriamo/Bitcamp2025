{"version":3,"names":["base64","NativeModules","WebRTCModule","FrameCryptorState","RTCKeyProvider","constructor","keyProviderId","_defineProperty","_id","setSharedKey","key","keyIndex","arguments","length","undefined","params","fromByteArray","keyProviderSetSharedKey","then","data","ratchetSharedKey","keyProviderRatchetSharedKey","toByteArray","exportSharedKey","keyProviderExportSharedKey","setKey","participantId","keyProviderSetKey","ratchetKey","keyProviderRatchetKey","exportKey","keyProviderExportKey","setSifTrailer","trailer","keyProviderSetSifTrailer","dispose","keyProviderDispose"],"sources":["RTCKeyProvider.ts"],"sourcesContent":["import * as base64 from 'base64-js';\nimport { NativeModules } from 'react-native';\nconst { WebRTCModule } = NativeModules;\n\nexport enum FrameCryptorState {\n  FrameCryptorStateNew,\n  FrameCryptorStateOk,\n  FrameCryptorStateEncryptionFailed,\n  FrameCryptorStateDecryptionFailed,\n  FrameCryptorStateMissingKey,\n  FrameCryptorStateKeyRatcheted,\n  FrameCryptorStateInternalError,\n}\n\nexport default class RTCKeyProvider {\n    _id: string;\n\n    constructor(keyProviderId: string) {\n        this._id = keyProviderId;\n    }\n\n    async setSharedKey(key: string | Uint8Array, keyIndex = 0) {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        if (typeof key === 'string') {\n            params['key'] = key;\n            params['keyIsBase64'] = false;\n        } else {\n            params['key'] = base64.fromByteArray(key as Uint8Array);\n            params['keyIsBase64'] = true;\n        }\n\n        return WebRTCModule.keyProviderSetSharedKey(params)\n            .then(data => data['result']);\n    }\n\n    async ratchetSharedKey(keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderRatchetSharedKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async exportSharedKey(keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderExportSharedKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async setKey(participantId: string, key: string | Uint8Array, keyIndex = 0): Promise<boolean> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        if (typeof key === 'string') {\n            params['key'] = key;\n            params['keyIsBase64'] = false;\n        } else {\n            params['key'] = base64.fromByteArray(key as Uint8Array);\n            params['keyIsBase64'] = true;\n        }\n\n        return WebRTCModule.keyProviderSetKey(params)\n            .then(data => data['result']);\n    }\n\n    async ratchetKey(participantId: string, keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderRatchetKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async exportKey(participantId: string, keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderExportKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async setSifTrailer(trailer: Uint8Array) {\n        const params = {\n            keyProviderId: this._id,\n            'sifTrailer': base64.fromByteArray(trailer),\n        };\n\n        return WebRTCModule.keyProviderSetSifTrailer(params);\n    }\n\n    async dispose() {\n        const params = {\n            keyProviderId: this._id,\n        };\n\n        return WebRTCModule.keyProviderDispose(params);\n    }\n}\n"],"mappings":"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"}