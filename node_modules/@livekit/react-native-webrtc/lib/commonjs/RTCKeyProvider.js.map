{"version":3,"names":["base64","_interopRequireWildcard","require","_reactNative","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_defineProperty","value","enumerable","configurable","writable","WebRTCModule","NativeModules","FrameCryptorState","exports","RTCKeyProvider","constructor","keyProviderId","_id","setSharedKey","keyIndex","arguments","length","undefined","params","fromByteArray","keyProviderSetSharedKey","then","data","ratchetSharedKey","keyProviderRatchetSharedKey","toByteArray","exportSharedKey","keyProviderExportSharedKey","setKey","participantId","keyProviderSetKey","ratchetKey","keyProviderRatchetKey","exportKey","keyProviderExportKey","setSifTrailer","trailer","keyProviderSetSifTrailer","dispose","keyProviderDispose"],"sources":["RTCKeyProvider.ts"],"sourcesContent":["import * as base64 from 'base64-js';\nimport { NativeModules } from 'react-native';\nconst { WebRTCModule } = NativeModules;\n\nexport enum FrameCryptorState {\n  FrameCryptorStateNew,\n  FrameCryptorStateOk,\n  FrameCryptorStateEncryptionFailed,\n  FrameCryptorStateDecryptionFailed,\n  FrameCryptorStateMissingKey,\n  FrameCryptorStateKeyRatcheted,\n  FrameCryptorStateInternalError,\n}\n\nexport default class RTCKeyProvider {\n    _id: string;\n\n    constructor(keyProviderId: string) {\n        this._id = keyProviderId;\n    }\n\n    async setSharedKey(key: string | Uint8Array, keyIndex = 0) {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        if (typeof key === 'string') {\n            params['key'] = key;\n            params['keyIsBase64'] = false;\n        } else {\n            params['key'] = base64.fromByteArray(key as Uint8Array);\n            params['keyIsBase64'] = true;\n        }\n\n        return WebRTCModule.keyProviderSetSharedKey(params)\n            .then(data => data['result']);\n    }\n\n    async ratchetSharedKey(keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderRatchetSharedKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async exportSharedKey(keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderExportSharedKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async setKey(participantId: string, key: string | Uint8Array, keyIndex = 0): Promise<boolean> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        if (typeof key === 'string') {\n            params['key'] = key;\n            params['keyIsBase64'] = false;\n        } else {\n            params['key'] = base64.fromByteArray(key as Uint8Array);\n            params['keyIsBase64'] = true;\n        }\n\n        return WebRTCModule.keyProviderSetKey(params)\n            .then(data => data['result']);\n    }\n\n    async ratchetKey(participantId: string, keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderRatchetKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async exportKey(participantId: string, keyIndex = 0): Promise<Uint8Array> {\n        const params = {\n            keyProviderId: this._id,\n            participantId,\n            keyIndex,\n        };\n\n        return WebRTCModule.keyProviderExportKey(params)\n            .then(data => base64.toByteArray(data['result']));\n    }\n\n    async setSifTrailer(trailer: Uint8Array) {\n        const params = {\n            keyProviderId: this._id,\n            'sifTrailer': base64.fromByteArray(trailer),\n        };\n\n        return WebRTCModule.keyProviderSetSifTrailer(params);\n    }\n\n    async dispose() {\n        const params = {\n            keyProviderId: this._id,\n        };\n\n        return WebRTCModule.keyProviderDispose(params);\n    }\n}\n"],"mappings":"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"}